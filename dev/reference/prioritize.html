<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Pick rows where score is 1 and level per loan is of highest priority — prioritize • r2dii.match</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Pick rows where score is 1 and level per loan is of highest priority — prioritize" />
<meta property="og:description" content="When multiple perfect matches are found per loan (e.g. a match at
direct_loantaker level and ultimate_parent level), we must prioritize the
desired match. By default, the highest priority is the most granular match
(i.e. direct_loantaker)." />


<meta name="robots" content="noindex">

<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">r2dii.match</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">0.0.8.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../articles/r2dii-match.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/matching-coverage.html">Calculating Matching Coverage</a>
    </li>
    <li>
      <a href="../articles/chunk-your-data.html">Using `match_name()` with large loanbooks</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    News
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Releases</li>
    <li>
      <a href="https://2degreesinvesting.github.io/posts/2020-08-14-r2dii-data-0-1-2-and-r2dii-match-0-0-4-are-now-on-cran/">Version 0.0.4</a>
    </li>
    <li>
      <a href="https://2degreesinvesting.github.io/r2dii.match/news/index.html#r2dii-match-0-0-3-2020-06-30">Version 0.0.3</a>
    </li>
    <li>
      <a href="https://2degreesinvesting.github.io/posts/2020-06-05-r2dii-match-0-0-2/">Version 0.0.2</a>
    </li>
    <li>
      <a href="../articles/r2dii-match-0-0-1.html">Version 0.0.1</a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="../news/index.html">Change log</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Packages
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="https://2degreesinvesting.github.io/r2dii.data">r2dii.data</a>
    </li>
    <li>
      <a href="https://2degreesinvesting.github.io/r2dii.match">r2dii.match</a>
    </li>
    <li>
      <a href="https://2degreesinvesting.github.io/r2dii.analysis">r2dii.analysis</a>
    </li>
  </ul>
</li>
<li>
  <a href="https://github.com/2DegreesInvesting/r2dii.match">
    <span class="fas fa-github"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Pick rows where <code>score</code> is 1 and <code>level</code> per loan is of highest <code>priority</code></h1>
    <small class="dont-index">Source: <a href='https://github.com/2DegreesInvesting/r2dii.match/blob/master/R/prioritize.R'><code>R/prioritize.R</code></a></small>
    <div class="hidden name"><code>prioritize.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>When multiple perfect matches are found per loan (e.g. a match at
<code>direct_loantaker</code> level and <code>ultimate_parent</code> level), we must prioritize the
desired match. By default, the highest <code>priority</code> is the most granular match
(i.e. <code>direct_loantaker</code>).</p>
    </div>

    <pre class="usage"><span class='fu'>prioritize</span><span class='op'>(</span><span class='va'>data</span>, priority <span class='op'>=</span> <span class='cn'>NULL</span><span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>data</th>
      <td><p>A data frame like the validated output of <code><a href='match_name.html'>match_name()</a></code>. See
<em>Details</em> on how to validate <code>data</code>.</p></td>
    </tr>
    <tr>
      <th>priority</th>
      <td><p>One of:</p><ul>
<li><p><code>NULL</code>: defaults to the default level priority as returned by
<code><a href='prioritize_level.html'>prioritize_level()</a></code>.</p></li>
<li><p>A character vector giving a custom priority.</p></li>
<li><p>A function to apply to the output of <code><a href='prioritize_level.html'>prioritize_level()</a></code>, e.g. <code>rev</code>.</p></li>
<li><p>A quosure-style lambda function, e.g. <code>~ rev(.x)</code>.</p></li>
</ul></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A data frame with a single row per loan, where <code>score</code> is 1 and
priority level is highest.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p><strong>How to validate <code>data</code></strong></p>
<p>Write the output of <code><a href='match_name.html'>match_name()</a></code> into a .csv file with:<div class="r"></p><pre><span class='co'># Writting to current working directory</span>
<span class='va'>matched</span> <span class='op'>%&gt;%</span>
  <span class='fu'>readr</span><span class='fu'>::</span><span class='fu'>write_csv</span><span class='op'>(</span><span class='st'>"matched.csv"</span><span class='op'>)</span>
</pre><p></div></p>
<p>Compare, edit, and save the data manually:</p><ul>
<li><p>Open <em>matched.csv</em> with any spreadsheet editor (Excel, Google
Sheets, etc.).</p></li>
<li><p>Compare the columns <code>name</code> and <code>name_ald</code> manually to determine if
the match is valid. Other information can be used in conjunction
with just the names to ensure the two entities match (sector,
internal information on the company structure, etc.)</p></li>
<li><p>Edit the data:</p><ul>
<li><p>If you are happy with the match, set the <code>score</code> value to <code>1</code>.</p></li>
<li><p>Otherwise set or leave the <code>score</code> value to anything other than
<code>1</code>.</p></li>
</ul></li>
<li><p>Save the edited file as, say, <em>valid_matches.csv</em>.</p></li>
</ul>

<p>Re-read the edited file (validated) with:<div class="r"></p><pre><span class='co'># Reading from current working directory</span>
<span class='va'>valid_matches</span> <span class='op'>&lt;-</span> <span class='fu'>readr</span><span class='fu'>::</span><span class='fu'>read_csv</span><span class='op'>(</span><span class='st'>"valid_matches.csv"</span><span class='op'>)</span>
</pre><p></div></p>
    <h2 class="hasAnchor" id="handling-grouped-data"><a class="anchor" href="#handling-grouped-data"></a>Handling grouped data</h2>

    

<p>This function ignores but preserves existing groups.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='match_name.html'>match_name()</a></code>, <code><a href='prioritize_level.html'>prioritize_level()</a></code>.</p>
<p>Other main functions: 
<code><a href='match_name.html'>match_name</a>()</code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://dplyr.tidyverse.org'>dplyr</a></span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'></span>
#&gt; <span class='message'>Attaching package: ‘dplyr’</span></div><div class='output co'>#&gt; <span class='message'>The following objects are masked from ‘package:stats’:</span>
#&gt; <span class='message'></span>
#&gt; <span class='message'>    filter, lag</span></div><div class='output co'>#&gt; <span class='message'>The following objects are masked from ‘package:base’:</span>
#&gt; <span class='message'></span>
#&gt; <span class='message'>    intersect, setdiff, setequal, union</span></div><div class='input'>
<span class='co'># styler: off</span>
<span class='va'>matched</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tribble.html'>tribble</a></span><span class='op'>(</span>
  <span class='op'>~</span><span class='va'>sector</span>, <span class='op'>~</span><span class='va'>sector_ald</span>,  <span class='op'>~</span><span class='va'>score</span>, <span class='op'>~</span><span class='va'>id_loan</span>,                <span class='op'>~</span><span class='va'>level</span>,
   <span class='st'>"coal"</span>,      <span class='st'>"coal"</span>,       <span class='fl'>1</span>,     <span class='st'>"aa"</span>,     <span class='st'>"ultimate_parent"</span>,
   <span class='st'>"coal"</span>,      <span class='st'>"coal"</span>,       <span class='fl'>1</span>,     <span class='st'>"aa"</span>,    <span class='st'>"direct_loantaker"</span>,
   <span class='st'>"coal"</span>,      <span class='st'>"coal"</span>,       <span class='fl'>1</span>,     <span class='st'>"bb"</span>, <span class='st'>"intermediate_parent"</span>,
   <span class='st'>"coal"</span>,      <span class='st'>"coal"</span>,       <span class='fl'>1</span>,     <span class='st'>"bb"</span>,     <span class='st'>"ultimate_parent"</span>,
<span class='op'>)</span>
<span class='co'># styler: on</span>

<span class='fu'><a href='prioritize_level.html'>prioritize_level</a></span><span class='op'>(</span><span class='va'>matched</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] "direct_loantaker"    "intermediate_parent" "ultimate_parent"    </div><div class='input'>
<span class='co'># Using default priority</span>
<span class='fu'>prioritize</span><span class='op'>(</span><span class='va'>matched</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span style='color: #555555;'># A tibble: 2 x 5</span><span>
#&gt;   sector sector_ald score id_loan level              
#&gt;   </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>  </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>      </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>   </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>              
#&gt; </span><span style='color: #555555;'>1</span><span> coal   coal           1 aa      direct_loantaker   
#&gt; </span><span style='color: #555555;'>2</span><span> coal   coal           1 bb      intermediate_parent</div><div class='input'>
<span class='co'># Using the reverse of the default priority</span>
<span class='fu'>prioritize</span><span class='op'>(</span><span class='va'>matched</span>, priority <span class='op'>=</span> <span class='va'>rev</span><span class='op'>)</span>
</div><div class='output co'>#&gt; </span><span style='color: #555555;'># A tibble: 2 x 5</span><span>
#&gt;   sector sector_ald score id_loan level          
#&gt;   </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>  </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>      </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>   </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>          
#&gt; </span><span style='color: #555555;'>1</span><span> coal   coal           1 aa      ultimate_parent
#&gt; </span><span style='color: #555555;'>2</span><span> coal   coal           1 bb      ultimate_parent</div><div class='input'>
<span class='co'># Same</span>
<span class='fu'>prioritize</span><span class='op'>(</span><span class='va'>matched</span>, priority <span class='op'>=</span> <span class='op'>~</span> <span class='fu'><a href='https://rdrr.io/r/base/rev.html'>rev</a></span><span class='op'>(</span><span class='va'>.x</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; </span><span style='color: #555555;'># A tibble: 2 x 5</span><span>
#&gt;   sector sector_ald score id_loan level          
#&gt;   </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>  </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>      </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>   </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>          
#&gt; </span><span style='color: #555555;'>1</span><span> coal   coal           1 aa      ultimate_parent
#&gt; </span><span style='color: #555555;'>2</span><span> coal   coal           1 bb      ultimate_parent</div><div class='input'>
<span class='co'># Using a custom priority</span>
<span class='va'>bad_idea</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"intermediate_parent"</span>, <span class='st'>"ultimate_parent"</span>, <span class='st'>"direct_loantaker"</span><span class='op'>)</span>

<span class='fu'>prioritize</span><span class='op'>(</span><span class='va'>matched</span>, priority <span class='op'>=</span> <span class='va'>bad_idea</span><span class='op'>)</span>
</div><div class='output co'>#&gt; </span><span style='color: #555555;'># A tibble: 2 x 5</span><span>
#&gt;   sector sector_ald score id_loan level              
#&gt;   </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>  </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>      </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>   </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>              
#&gt; </span><span style='color: #555555;'>1</span><span> coal   coal           1 bb      intermediate_parent
#&gt; </span><span style='color: #555555;'>2</span><span> coal   coal           1 aa      ultimate_parent    </div></span></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by <a href='https://github.com/maurolepore/'>Mauro Lepore</a>, <a href='https://github.com/jdhoffa/'>Jackson Hoffart</a>, Klaus Hagedorn, Florence Palandri, Evgeny Petrovsky, <a href='https://2degrees-investing.org/'>2 Degrees Investing Initiative</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


