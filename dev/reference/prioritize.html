<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="When multiple perfect matches are found per loan (e.g. a match at
direct_loantaker level and ultimate_parent level), we must prioritize the
desired match. By default, the highest priority is the most granular match
(i.e. direct_loantaker)."><title>Pick rows where score is 1 and level per loan is of highest priority — prioritize • r2dii.match</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Pick rows where score is 1 and level per loan is of highest priority — prioritize"><meta property="og:description" content="When multiple perfect matches are found per loan (e.g. a match at
direct_loantaker level and ultimate_parent level), we must prioritize the
desired match. By default, the highest priority is the most granular match
(i.e. direct_loantaker)."><meta property="og:image" content="https://2degreesinvesting.github.io/r2dii.match/logo.svg"><meta name="robots" content="noindex"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-default navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">r2dii.match</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.1.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/r2dii-match.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/matching-coverage.html">Calculating Matching Coverage</a>
    <a class="dropdown-item" href="../articles/chunk-your-data.html">Using `match_name()` with large loanbooks</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-news">News</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-news">
    <a class="external-link dropdown-item" href="https://2degreesinvesting.github.io/#category:r2dii">r2dii blog posts</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../news/index.html">Change log</a>
  </div>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-packages">Packages</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-packages">
    <a class="external-link dropdown-item" href="https://2degreesinvesting.github.io/r2dii.data">r2dii.data</a>
    <a class="dropdown-item" href="https://2degreesinvesting.github.io/r2dii.match">r2dii.match</a>
    <a class="external-link dropdown-item" href="https://2degreesinvesting.github.io/r2dii.analysis">r2dii.analysis</a>
    <a class="external-link dropdown-item" href="https://2degreesinvesting.github.io/r2dii.plot">r2dii.plot</a>
  </div>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/2DegreesInvesting/r2dii.match">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Pick rows where <code>score</code> is 1 and <code>level</code> per loan is of highest <code>priority</code></h1>
      <small class="dont-index">Source: <a href="https://github.com/2DegreesInvesting/r2dii.match/blob/HEAD/R/prioritize.R" class="external-link"><code>R/prioritize.R</code></a></small>
      <div class="d-none name"><code>prioritize.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>When multiple perfect matches are found per loan (e.g. a match at
<code>direct_loantaker</code> level and <code>ultimate_parent</code> level), we must prioritize the
desired match. By default, the highest <code>priority</code> is the most granular match
(i.e. <code>direct_loantaker</code>).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">prioritize</span><span class="op">(</span><span class="va">data</span>, priority <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>data</dt>
<dd><p>A data frame like the validated output of <code><a href="match_name.html">match_name()</a></code>. See
<em>Details</em> on how to validate <code>data</code>.</p></dd>


<dt>priority</dt>
<dd><p>One of:</p><ul><li><p><code>NULL</code>: defaults to the default level priority as returned by
<code><a href="prioritize_level.html">prioritize_level()</a></code>.</p></li>
<li><p>A character vector giving a custom priority.</p></li>
<li><p>A function to apply to the output of <code><a href="prioritize_level.html">prioritize_level()</a></code>, e.g. <code>rev</code>.</p></li>
<li><p>A quosure-style lambda function, e.g. <code>~ rev(.x)</code>.</p></li>
</ul></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A data frame with a single row per loan, where <code>score</code> is 1 and
priority level is highest.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><strong>How to validate <code>data</code></strong></p>
<p>Write the output of <code><a href="match_name.html">match_name()</a></code> into a .csv file with:</p><div class="sourceCode r"><pre><code><span><span class="co"># Writting to current working directory</span></span>
<span><span class="va">matched</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">readr</span><span class="fu">::</span><span class="fu">write_csv</span><span class="op">(</span><span class="st">"matched.csv"</span><span class="op">)</span></span></code></pre><p></p></div>
<p>Compare, edit, and save the data manually:</p><ul><li><p>Open <em>matched.csv</em> with any spreadsheet editor (Excel, Google
Sheets, etc.).</p></li>
<li><p>Compare the columns <code>name</code> and <code>name_abcd</code> manually to determine if
the match is valid. Other information can be used in conjunction
with just the names to ensure the two entities match (sector,
internal information on the company structure, etc.)</p></li>
<li><p>Edit the data:</p><ul><li><p>If you are happy with the match, set the <code>score</code> value to <code>1</code>.</p></li>
<li><p>Otherwise set or leave the <code>score</code> value to anything other than
<code>1</code>.</p></li>
</ul></li>
<li><p>Save the edited file as, say, <em>valid_matches.csv</em>.</p></li>
</ul><p>Re-read the edited file (validated) with:</p><div class="sourceCode r"><pre><code><span><span class="co"># Reading from current working directory</span></span>
<span><span class="va">valid_matches</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu">read_csv</span><span class="op">(</span><span class="st">"valid_matches.csv"</span><span class="op">)</span></span></code></pre><p></p></div>
    </div>
    <div class="section level2">
    <h2 id="handling-grouped-data">Handling grouped data<a class="anchor" aria-label="anchor" href="#handling-grouped-data"></a></h2>
    

<p>This function ignores but preserves existing groups.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="match_name.html">match_name()</a></code>, <code><a href="prioritize_level.html">prioritize_level()</a></code>.</p>
<p>Other main functions: 
<code><a href="match_name.html">match_name</a>()</code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Attaching package: ‘dplyr’</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following objects are masked from ‘package:stats’:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     filter, lag</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following objects are masked from ‘package:base’:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     intersect, setdiff, setequal, union</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># styler: off</span></span></span>
<span class="r-in"><span><span class="va">matched</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="op">~</span><span class="va">sector</span>, <span class="op">~</span><span class="va">sector_abcd</span>,  <span class="op">~</span><span class="va">score</span>, <span class="op">~</span><span class="va">id_loan</span>,                <span class="op">~</span><span class="va">level</span>,</span></span>
<span class="r-in"><span>   <span class="st">"coal"</span>,      <span class="st">"coal"</span>,       <span class="fl">1</span>,     <span class="st">"aa"</span>,     <span class="st">"ultimate_parent"</span>,</span></span>
<span class="r-in"><span>   <span class="st">"coal"</span>,      <span class="st">"coal"</span>,       <span class="fl">1</span>,     <span class="st">"aa"</span>,    <span class="st">"direct_loantaker"</span>,</span></span>
<span class="r-in"><span>   <span class="st">"coal"</span>,      <span class="st">"coal"</span>,       <span class="fl">1</span>,     <span class="st">"bb"</span>, <span class="st">"intermediate_parent"</span>,</span></span>
<span class="r-in"><span>   <span class="st">"coal"</span>,      <span class="st">"coal"</span>,       <span class="fl">1</span>,     <span class="st">"bb"</span>,     <span class="st">"ultimate_parent"</span>,</span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># styler: on</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="prioritize_level.html">prioritize_level</a></span><span class="op">(</span><span class="va">matched</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "direct_loantaker"    "intermediate_parent" "ultimate_parent"    </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Using default priority</span></span></span>
<span class="r-in"><span><span class="fu">prioritize</span><span class="op">(</span><span class="va">matched</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 2 × 5</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   sector sector_abcd score id_loan level              </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span> coal   coal            1 aa      direct_loantaker   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span> coal   coal            1 bb      intermediate_parent</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Using the reverse of the default priority</span></span></span>
<span class="r-in"><span><span class="fu">prioritize</span><span class="op">(</span><span class="va">matched</span>, priority <span class="op">=</span> <span class="va">rev</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 2 × 5</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   sector sector_abcd score id_loan level          </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span> coal   coal            1 aa      ultimate_parent</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span> coal   coal            1 bb      ultimate_parent</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Same</span></span></span>
<span class="r-in"><span><span class="fu">prioritize</span><span class="op">(</span><span class="va">matched</span>, priority <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">.x</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 2 × 5</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   sector sector_abcd score id_loan level          </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span> coal   coal            1 aa      ultimate_parent</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span> coal   coal            1 bb      ultimate_parent</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Using a custom priority</span></span></span>
<span class="r-in"><span><span class="va">bad_idea</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"intermediate_parent"</span>, <span class="st">"ultimate_parent"</span>, <span class="st">"direct_loantaker"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">prioritize</span><span class="op">(</span><span class="va">matched</span>, priority <span class="op">=</span> <span class="va">bad_idea</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 2 × 5</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   sector sector_abcd score id_loan level              </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span> coal   coal            1 bb      intermediate_parent</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span> coal   coal            1 aa      ultimate_parent    </span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by <a href="https://github.com/jdhoffa/" class="external-link">Jackson Hoffart</a>, <a href="https://github.com/maurolepore/" class="external-link">Mauro Lepore</a>, Klaus Hagedorn, Florence Palandri, Evgeny Petrovsky, <a href="https://2degrees-investing.org/" class="external-link">2 Degrees Investing Initiative</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer></div>

  

  

  </body></html>

