<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="r2dii.match">
<title>Introduction to r2dii.match • r2dii.match</title>
<link rel="icon" type="image/png" sizes="16x16" href="/headshot_placeholder.png">
<link rel="icon" type="image/png" sizes="32x32" href="/headshot_placeholder.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/headshot_placeholder.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Overpass-0.4.9/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to r2dii.match">
<meta property="og:description" content="r2dii.match">
<meta property="og:image" content="https://rmi-pacta.github.io/r2dii.match/logo.png">
<meta name="robots" content="noindex">
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-default navbar-expand-lg bg-info" data-bs-theme="default"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">r2dii.match</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.2.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/r2dii-match.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/matching-coverage.html">Calculating Matching Coverage</a>
    <a class="dropdown-item" href="../articles/chunk-your-data.html">Using `match_name()` with large loanbooks</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-news">News</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-news">
    <a class="external-link dropdown-item" href="https://rmi-pacta.github.io/#category:r2dii">r2dii blog posts</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../news/index.html">Change log</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-packages">Packages</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-packages">
    <a class="external-link dropdown-item" href="https://rmi-pacta.github.io/r2dii.data">r2dii.data</a>
    <a class="dropdown-item" href="https://rmi-pacta.github.io/r2dii.match">r2dii.match</a>
    <a class="external-link dropdown-item" href="https://rmi-pacta.github.io/r2dii.analysis">r2dii.analysis</a>
    <a class="external-link dropdown-item" href="https://rmi-pacta.github.io/r2dii.plot">r2dii.plot</a>
  </div>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/RMI-PACTA/r2dii.match">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Introduction to r2dii.match</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/RMI-PACTA/r2dii.match/blob/HEAD/vignettes/r2dii-match.Rmd" class="external-link"><code>vignettes/r2dii-match.Rmd</code></a></small>
      <div class="d-none name"><code>r2dii-match.Rmd</code></div>
    </div>

    
    
<p>The package r2dii.match helps you to match counterparties from a
loanbook to companies in a physical-asset database. Each section below
shows you how.</p>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p>We use the package r2dii.match to access the most important functions
you’ll learn about. We also use example datasets from the package
r2dii.data, and optional but convenient functions from the packages
dplyr and readr.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rmi-pacta.github.io/r2dii.data/" class="external-link">r2dii.data</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rmi-pacta.github.io/r2dii.match/">r2dii.match</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="format-input-data-loanbook-and-asset-based-company-data-abcd">Format input data loanbook and asset-based company data (abcd)<a class="anchor" aria-label="anchor" href="#format-input-data-loanbook-and-asset-based-company-data-abcd"></a>
</h2>
<p>We need two datasets: a “loanbook” and an “asset-based company
dataset” (abcd). These should be formatted like: <a href="https://rmi-pacta.github.io/r2dii.data/reference/loanbook_demo.html" class="external-link"><code>loanbook_demo</code></a>
and <a href="https://rmi-pacta.github.io/r2dii.data/reference/abcd_demo.html" class="external-link"><code>abcd_demo</code></a>
(from the <a href="https://rmi-pacta.github.io/r2dii.data" class="external-link">r2dii.data
package</a>).</p>
<p>A note on sector classification: Matches are preferred when the
sector from the <code>loanbook</code> matches the sector from the
<code>abcd</code>. The <code>loanbook</code> sector is determined
internally using the <code>sector_classification_system</code> and
<code>sector_classification_direct_loantaker</code> columns. Currently,
we only allow a couple specific values for
<code>sector_classification_system</code>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sector_classifications</span><span class="op">$</span><span class="va">code_system</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "CNB"   "GICS"  "ISIC"  "NACE"  "NAICS" "PSIC"  "SIC"</span></span></code></pre></div>
<p>If you would like to use a different classification system, please
raise an issue in <a href="https://github.com/RMI-PACTA/r2dii.data" class="external-link">r2dii.data</a> and we can
incorporate it.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">loanbook_demo</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 283 × 19</span></span></span>
<span><span class="co">#&gt;    id_loan id_direct_loantaker name_direct_loantaker      id_intermediate_pare…¹</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> L1      C294                Vitale Group               <span style="color: #BB0000;">NA</span>                    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> L2      C293                Moen-Moen                  <span style="color: #BB0000;">NA</span>                    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> L3      C292                Rowe-Rowe                  IP5                   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> L4      C299                Fadel-Fadel                <span style="color: #BB0000;">NA</span>                    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> L5      C305                Ring AG &amp; Co. KGaA         <span style="color: #BB0000;">NA</span>                    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> L6      C304                Kassulke-Kassulke          <span style="color: #BB0000;">NA</span>                    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> L7      C227                Morissette Group           <span style="color: #BB0000;">NA</span>                    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> L8      C303                Barone s.r.l.              <span style="color: #BB0000;">NA</span>                    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> L9      C301                Werner Werner AG &amp; Co. KG… IP10                  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> L10     C302                De rosa s.r.l.             <span style="color: #BB0000;">NA</span>                    </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 273 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ abbreviated name: ¹​id_intermediate_parent_1</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 15 more variables: name_intermediate_parent_1 &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   id_ultimate_parent &lt;chr&gt;, name_ultimate_parent &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   loan_size_outstanding &lt;dbl&gt;, loan_size_outstanding_currency &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   loan_size_credit_limit &lt;dbl&gt;, loan_size_credit_limit_currency &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   sector_classification_system &lt;chr&gt;, …</span></span></span>
<span></span>
<span><span class="va">abcd_demo</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4,972 × 14</span></span></span>
<span><span class="co">#&gt;    company_id name_company         lei   sector technology production_unit  year</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 184        Giordano, Giordano … 2756… power  hydrocap   MW               <span style="text-decoration: underline;">2</span>020</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 184        Giordano, Giordano … 2756… power  hydrocap   MW               <span style="text-decoration: underline;">2</span>021</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 184        Giordano, Giordano … 2756… power  hydrocap   MW               <span style="text-decoration: underline;">2</span>022</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 184        Giordano, Giordano … 2756… power  hydrocap   MW               <span style="text-decoration: underline;">2</span>023</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 184        Giordano, Giordano … 2756… power  hydrocap   MW               <span style="text-decoration: underline;">2</span>024</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 184        Giordano, Giordano … 2756… power  hydrocap   MW               <span style="text-decoration: underline;">2</span>025</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 527        Vitali, Vitali e Vi… 9341… cement integrate… tonnes per year  <span style="text-decoration: underline;">2</span>020</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 527        Vitali, Vitali e Vi… 9341… cement integrate… tonnes per year  <span style="text-decoration: underline;">2</span>021</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 527        Vitali, Vitali e Vi… 9341… cement integrate… tonnes per year  <span style="text-decoration: underline;">2</span>022</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 527        Vitali, Vitali e Vi… 9341… cement integrate… tonnes per year  <span style="text-decoration: underline;">2</span>023</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 4,962 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 7 more variables: production &lt;dbl&gt;, emission_factor &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   country_of_domicile &lt;chr&gt;, plant_location &lt;chr&gt;, is_ultimate_owner &lt;lgl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   abcd_timestamp &lt;chr&gt;, emission_factor_unit &lt;chr&gt;</span></span></span></code></pre></div>
<p>If you want to use <code>loanbook_demo</code> and
<code>abcd_demo</code> as template to create your own datasets, do
this:</p>
<ul>
<li>Write <em>loanbook_demo.csv</em> and <em>abcd_demo.csv</em>
with:</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Writting to current working directory </span></span>
<span><span class="va">loanbook_demo</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">readr</span><span class="fu">::</span><span class="fu">write_csv</span><span class="op">(</span>path <span class="op">=</span> <span class="st">"loanbook_demo.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">abcd_demo</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">readr</span><span class="fu">::</span><span class="fu">write_csv</span><span class="op">(</span>path <span class="op">=</span> <span class="st">"abcd_demo.csv"</span><span class="op">)</span></span></code></pre></div>
<ul>
<li>For each dataset, replace our demo data with your data.</li>
<li>Save each dataset as, for example, <em>your_loanbook.csv</em> and
<em>your_abcd.csv</em>.</li>
<li>Read your datasets back into R with:</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Reading from current working directory </span></span>
<span><span class="va">your_loanbook</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu">read_csv</span><span class="op">(</span><span class="st">"your_loanbook.csv"</span><span class="op">)</span></span>
<span><span class="va">your_abcd</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu">read_csv</span><span class="op">(</span><span class="st">"your_abcd.csv"</span><span class="op">)</span></span></code></pre></div>
<p>Here we continue to use the <code>*_demo</code> datasets, pretending
they contain the data of your own.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># WARNING: Skip this to avoid overwriting your data with our demo data</span></span>
<span><span class="va">your_loanbook</span> <span class="op">&lt;-</span> <span class="va">loanbook_demo</span></span>
<span><span class="va">your_abcd</span> <span class="op">&lt;-</span> <span class="va">abcd_demo</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="score-the-goodness-of-the-match-between-the-loanbook-and-abcd-datasets">Score the goodness of the match between the loanbook and abcd
datasets<a class="anchor" aria-label="anchor" href="#score-the-goodness-of-the-match-between-the-loanbook-and-abcd-datasets"></a>
</h2>
<p><code><a href="../reference/match_name.html">match_name()</a></code> scores the match between names in a
loanbook dataset (lbk) and names in an asset-based company dataset
(abcd). The names come from the columns
<code>name_direct_loantaker</code>,
<code>name_intermediate_parent_*</code> and
<code>name_ultimate_parent</code> of the loanbook dataset, and from the
column <code>name_company</code> of the a asset-based company dataset.
There can be any number of <code>name_intermediate_parent_*</code>
columns, where <code>*</code> indicates the level up the corporate tree
from <code>direct_loantaker</code>.</p>
<p>The raw names are internally transformed applying best-practices
commonly used in name matching algorithms, such as:</p>
<ul>
<li>Remove special characters.</li>
<li>Replace language specific characters.</li>
<li>Abbreviate certain names to reduce their importance in the
matching.</li>
<li>Removing corporate suffixes when necessary.</li>
<li>Spell out numbers to increase their importance.</li>
</ul>
<p>The similarity is then scored between the internally-transformed
names of the loanbook against the abcd. (For more information on the
scoring algorithm used, see: <code><a href="https://rdrr.io/pkg/stringdist/man/stringsim.html" class="external-link">stringdist::stringsim()</a></code>).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/match_name.html">match_name</a></span><span class="op">(</span><span class="va">your_loanbook</span>, <span class="va">your_abcd</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 329 × 28</span></span></span>
<span><span class="co">#&gt;    id_loan id_direct_loantaker name_direct_loantaker      id_intermediate_pare…¹</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> L1      C294                Vitale Group               <span style="color: #BB0000;">NA</span>                    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> L3      C292                Rowe-Rowe                  IP5                   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> L5      C305                Ring AG &amp; Co. KGaA         <span style="color: #BB0000;">NA</span>                    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> L6      C304                Kassulke-Kassulke          <span style="color: #BB0000;">NA</span>                    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> L6      C304                Kassulke-Kassulke          <span style="color: #BB0000;">NA</span>                    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> L7      C227                Morissette Group           <span style="color: #BB0000;">NA</span>                    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> L7      C227                Morissette Group           <span style="color: #BB0000;">NA</span>                    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> L8      C303                Barone s.r.l.              <span style="color: #BB0000;">NA</span>                    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> L9      C301                Werner Werner AG &amp; Co. KG… IP10                  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> L9      C301                Werner Werner AG &amp; Co. KG… IP10                  </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 319 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ abbreviated name: ¹​id_intermediate_parent_1</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 24 more variables: name_intermediate_parent_1 &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   id_ultimate_parent &lt;chr&gt;, name_ultimate_parent &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   loan_size_outstanding &lt;dbl&gt;, loan_size_outstanding_currency &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   loan_size_credit_limit &lt;dbl&gt;, loan_size_credit_limit_currency &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   sector_classification_system &lt;chr&gt;, …</span></span></span></code></pre></div>
<p><code><a href="../reference/match_name.html">match_name()</a></code> defaults to scoring matches between name
strings that belong to the same sector. Using
<code>by_sector = FALSE</code> removes this limitation – increasing
computation time, and the number of potentially incorrect matches to
manually validate.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/match_name.html">match_name</a></span><span class="op">(</span><span class="va">your_loanbook</span>, <span class="va">your_abcd</span>, by_sector <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 675</span></span>
<span></span>
<span><span class="co"># Compare</span></span>
<span><span class="fu"><a href="../reference/match_name.html">match_name</a></span><span class="op">(</span><span class="va">your_loanbook</span>, <span class="va">your_abcd</span>, by_sector <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 329</span></span></code></pre></div>
<p><code>min_score</code> allows you to minimum threshold
<code>score</code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">matched</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/match_name.html">match_name</a></span><span class="op">(</span><span class="va">your_loanbook</span>, <span class="va">your_abcd</span>, min_score <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">matched</span><span class="op">$</span><span class="va">score</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.9007692 1.0000000</span></span></code></pre></div>
<div class="section level3">
<h3 id="maybe-overwrite-matches">Maybe overwrite matches<a class="anchor" aria-label="anchor" href="#maybe-overwrite-matches"></a>
</h3>
<p>If you are happy with the matching coverage achieved, proceed to the
next step. Otherwise, you can manually add matches, not found
automatically by <code><a href="../reference/match_name.html">match_name()</a></code>. To do this, manually inspect
the <code>abcd</code> and find a company you would like to match to your
loanbook. Once a match is found, use excel to write a .csv file similar
to <a href="https://rmi-pacta.github.io/r2dii.data/reference/overwrite_demo.html" class="external-link"><code>overwrite_demo</code></a>,
where:</p>
<ul>
<li>
<code>level</code> indicates the level that the manual match should
be added to (e.g. <code>direct_loantaker</code>)</li>
<li>
<code>id_2dii</code> is the id of the loanbook company you would
like to match (from the output of <code><a href="../reference/match_name.html">match_name()</a></code>)</li>
<li>
<code>name</code> is the abcd company you would like to manually
link to</li>
<li>
<code>sector</code> optionally you can also overwrite the
sector.</li>
<li>
<code>source</code> this can be used later to determine where all
manual matches came from.</li>
</ul>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">matched</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/match_name.html">match_name</a></span><span class="op">(</span></span>
<span>  <span class="va">your_loanbook</span>, <span class="va">your_abcd</span>,</span>
<span>  min_score <span class="op">=</span> <span class="fl">0.9</span>, overwrite <span class="op">=</span> <span class="va">overwrite_demo</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: You should only overwrite a sector at the level of the 'direct</span></span>
<span><span class="co">#&gt; loantaker' (DL). If you overwrite a sector at the level of the 'ultimate</span></span>
<span><span class="co">#&gt; parent' (UP) you consequently overwrite all children of that sector,</span></span>
<span><span class="co">#&gt; which most likely is a mistake.</span></span></code></pre></div>
<p>Notice the warning.</p>
</div>
</div>
<div class="section level2">
<h2 id="validate-matches">Validate matches<a class="anchor" aria-label="anchor" href="#validate-matches"></a>
</h2>
<p>Write the output of <code><a href="../reference/match_name.html">match_name()</a></code> into a .csv file
with:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Writting to current working directory</span></span>
<span><span class="va">matched</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">readr</span><span class="fu">::</span><span class="fu">write_csv</span><span class="op">(</span><span class="st">"matched.csv"</span><span class="op">)</span></span></code></pre></div>
<p>Compare, edit, and save the data manually:</p>
<ul>
<li>Open <em>matched.csv</em> with any spreadsheet editor (Excel, Google
Sheets, etc.).</li>
<li>Compare the columns <code>name</code> and <code>name_abcd</code>
manually to determine if the match is valid. Other information can be
used in conjunction with just the names to ensure the two entities match
(sector, internal information on the company structure, etc.)</li>
<li>Edit the data:
<ul>
<li>If you are happy with the match, set the <code>score</code> value to
<code>1</code>.</li>
<li>Otherwise set or leave the <code>score</code> value to anything
other than <code>1</code>.</li>
</ul>
</li>
<li>Save the edited file as, say, <em>valid_matches.csv</em>.</li>
</ul>
<p>Re-read the edited file (validated) with:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Reading from current working directory</span></span>
<span><span class="va">valid_matches</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu">read_csv</span><span class="op">(</span><span class="st">"valid_matches.csv"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="prioritize-validated-matches-by-level">Prioritize validated matches by level<a class="anchor" aria-label="anchor" href="#prioritize-validated-matches-by-level"></a>
</h2>
<p>The validated dataset may have multiple matches per loan. Consider
the case where a loan is given to “Acme Power USA”, a subsidiary of
“Acme Power Co.”. There may be both “Acme Power USA” and “Acme Power
Co.” in the <code>abcd</code>, and so there could be two valid matches
for this loan. To get the best match only, use <code><a href="../reference/prioritize.html">prioritize()</a></code>
– it picks rows where <code>score</code> is 1 and <code>level</code> per
loan is of highest <code>priority()</code>:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Pretend we validated the matched dataset</span></span>
<span><span class="va">valid_matches</span> <span class="op">&lt;-</span> <span class="va">matched</span></span>
<span></span>
<span><span class="va">some_interesting_columns</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id_2dii"</span>, <span class="st">"level"</span>, <span class="st">"score"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">valid_matches</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/prioritize.html">prioritize</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">all_of</a></span><span class="op">(</span><span class="va">some_interesting_columns</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 175 × 3</span></span></span>
<span><span class="co">#&gt;    id_2dii level            score</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> DL129   direct_loantaker     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> DL144   direct_loantaker     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> DL270   direct_loantaker     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> DL86    direct_loantaker     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> DL5     direct_loantaker     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> DL80    direct_loantaker     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> DL150   direct_loantaker     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> DL3     direct_loantaker     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> DL65    direct_loantaker     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> DL79    direct_loantaker     1</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 165 more rows</span></span></span></code></pre></div>
<p>By default, highest priority refers to the most granular match
(<code>direct_loantaker</code>). The default priority is set internally
via <code>prioritize_levels()</code>.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/prioritize_level.html">prioritize_level</a></span><span class="op">(</span><span class="va">matched</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "direct_loantaker"      "intermediate_parent_1" "ultimate_parent"</span></span></code></pre></div>
<p>You may use a different priority. One way to do that is to pass a
function to <code>priority</code>. For example, use <code>rev</code> to
reverse the default priority.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">matched</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/prioritize.html">prioritize</a></span><span class="op">(</span>priority <span class="op">=</span> <span class="va">rev</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">all_of</a></span><span class="op">(</span><span class="va">some_interesting_columns</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 175 × 3</span></span></span>
<span><span class="co">#&gt;    id_2dii level           score</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> UP190   ultimate_parent     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> UP101   ultimate_parent     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> UP39    ultimate_parent     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> UP63    ultimate_parent     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> UP224   ultimate_parent     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> UP132   ultimate_parent     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> UP12    ultimate_parent     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> UP20    ultimate_parent     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> UP134   ultimate_parent     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> UP127   ultimate_parent     1</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 165 more rows</span></span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><!-- begin footer --><div class="footer">
    <div class="container">
        <div class="row start top-4 bottom-8">
            <div class="col-2"> <img id="footerlogo" src="../rmi_logo_stacked_tag_white.svg">
</div>
            <div class="col-10">
                <div class="row">
                    <div class="col-md-4 col-xs-6">
                        <a href="https://pacta.rmi.org/" target="_blank" class="external-link"><div class="icon fa fa-link"></div></a>
                        <a href="https://github.com/RMI-PACTA" target="_blank" class="external-link"><div class="icon fab fa-github"></div></a>
                        <a href="https://twitter.com/RockyMtnInst" target="_blank" class="external-link"><div class="icon fab fa-twitter"></div></a>
                        <a href="https://www.linkedin.com/showcase/rmi-pacta/" target="_blank" class="external-link"><div class="icon fab fa-linkedin-in"></div></a>
                    </div>
                </div>
                    <div class="col-md-4 col-xs-12">
                        <h5 class="bottom-2"></h5>

                        <p>© RMI</p>

                    </div>
                </div>
            </div>
        </div>
    </div>
</footer>
</div>
<!-- / end footer -->

    
   

  

  

  </body>
</html>
